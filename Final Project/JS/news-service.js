// Модуль для работы с данными новостей
export class NewsService {
    constructor() {
        this.news = this.generateNewsData();
    }
    
    // Генерация тестовых данных
    generateNewsData() {
        return [
            {
                id: 1,
                title: "Правительство представило новый экономический план",
                excerpt: "Министр экономики объявил о стратегии развития на ближайшие пять лет с акцентом на технологическую модернизацию.",
                content: "<p>Сегодня правительство представило новый экономический план, направленный на стимулирование роста и технологическую модернизацию страны. Министр экономики заявил, что основной акцент будет сделан на цифровизации ключевых отраслей и поддержке малого бизнеса.</p><p>План включает в себя налоговые льготы для IT-компаний, инвестиции в инфраструктуру и программы переобучения для работников традиционных отраслей. Эксперты положительно оценивают предложенные меры, но отмечают необходимость их детальной проработки.</p>",
                category: "politics",
                date: "2023-11-15",
                image: "https://images.unsplash.com/photo-1551135049-8a33b2fb2f7f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Александр Иванов",
                views: 1245
            },
            {
                id: 2,
                title: "Криптовалюты показали рекордный рост",
                excerpt: "За последнюю неделю основные криптовалюты выросли в цене на 15-20%, что связано с новыми регуляторными решениями.",
                content: "<p>Криптовалютный рынок демонстрирует впечатляющий рост: за последние семь дней Bitcoin подорожал на 18%, Ethereum — на 22%. Аналитики связывают это с принятием новых регуляторных рамок в нескольких странах ЕС.</p><p>Эксперты предупреждают о высокой волатильности рынка и рекомендуют инвесторам проявлять осторожность. Тем временем, центральные банки разных стран продолжают изучать возможности выпуска собственных цифровых валют.</p>",
                category: "economy",
                date: "2023-11-14",
                image: "https://images.unsplash.com/photo-1620336655055-bd87c5d1d73f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Мария Петрова",
                views: 2103
            },
            {
                id: 3,
                title: "Новый смартфон с гибким экраном представлен на выставке",
                excerpt: "Компания представила инновационный смартфон с гибким экраном, который можно складывать пополам.",
                content: "<p>На международной выставке мобильных технологий была представлена новинка - смартфон с гибким OLED-экраном. Устройство может складываться пополам, что делает его компактным для переноски.</p><p>Технология использует специальный полимерный материал, который выдерживает до 200 000 циклов складывания. Представители компании заявили, что это революция в дизайне мобильных устройств.</p>",
                category: "technology",
                date: "2023-11-13",
                image: "https://images.unsplash.com/photo-1598327105666-5b89351aff97?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Сергей Смирнов",
                views: 3156
            },
            {
                id: 4,
                title: "Сборная страны вышла в финал чемпионата мира",
                excerpt: "В напряженном матче национальная сборная одержала победу и обеспечила себе место в финале мирового первенства.",
                content: "<p>В полуфинальном матче чемпионата мира национальная сборная одержала победу со счетом 2:1. Решающий гол был забит на 89-й минуте матча.</p><p>Тренер команды отметил отличную работу защитников и самоотверженность всех игроков. Финальный матч состоится через неделю в столице принимающей страны.</p>",
                category: "sports",
                date: "2023-11-12",
                image: "https://images.unsplash.com/photo-1461896836934-ffe607ba8211?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Андрей Козлов",
                views: 4289
            },
            {
                id: 5,
                title: "Открытие нового музея современного искусства",
                excerpt: "В центре города открылся музей современного искусства с коллекцией работ молодых художников.",
                content: "<p>Сегодня состоялось торжественное открытие нового музея современного искусства. В экспозиции представлены работы как известных мастеров, так и молодых перспективных художников.</p><p>Особенностью музея стали интерактивные инсталляции и использование цифровых технологий в экспозиции. Организаторы надеются, что музей станет культурным центром города.</p>",
                category: "culture",
                date: "2023-11-11",
                image: "https://images.unsplash.com/photo-1578301978693-85fa9c0320b9?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Елена Волкова",
                views: 1876
            },
            {
                id: 6,
                title: "Изменения в налоговом законодательстве",
                excerpt: "Парламент принял ряд поправок в налоговый кодекс, направленных на поддержку малого бизнеса.",
                content: "<p>Сегодня парламент утвердил пакет поправок в налоговое законодательство. Основные изменения касаются упрощения системы налогообложения для малого и среднего бизнеса.</p><p>Эксперты отмечают, что новые правила позволят снизить административную нагрузку на предпринимателей и стимулировать создание новых рабочих мест.</p>",
                category: "politics",
                date: "2023-11-10",
                image: "https://images.unsplash.com/photo-1554224155-6726b3ff858f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Дмитрий Новиков",
                views: 2341
            },
            {
                id: 7,
                title: "Фондовая биржа обновила исторический максимум",
                excerpt: "Основные индексы фондовой биржи показали рост и достигли новых рекордных значений.",
                content: "<p>Сегодня торги на фондовой бирже завершились рекордным ростом основных индексов. Индекс широкого рынка вырос на 2.3%, обновив исторический максимум.</p><p>Аналитики связывают рост с позитивными корпоративными отчетами и улучшением макроэкономических показателей. Инвесторы проявляют повышенный интерес к технологическому сектору.</p>",
                category: "economy",
                date: "2023-11-09",
                image: "https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Ольга Семенова",
                views: 1897
            },
            {
                id: 8,
                title: "Искусственный интеллект научился предсказывать погоду",
                excerpt: "Новая система на основе искусственного интеллекта демонстрирует высокую точность в прогнозировании погоды.",
                content: "<p>Ученые представили систему искусственного интеллекта, которая способна предсказывать погоду с точностью 95% на 10 дней вперед. Система анализирует огромные массивы данных с метеорологических спутников.</p><p>Разработчики отмечают, что алгоритм постоянно обучается и улучшает свои прогностические способности. В будущем подобные системы могут стать стандартом в метеорологии.</p>",
                category: "technology",
                date: "2023-11-08",
                image: "https://images.unsplash.com/photo-1555949963-aa79dcee981c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Иван Петров",
                views: 2765
            },
            {
                id: 9,
                title: "Новый стадион примет матчи чемпионата мира",
                excerpt: "Завершено строительство современного стадиона, который станет одной из площадок мирового первенства.",
                content: "<p>Сегодня состоялась церемония открытия нового футбольного стадиона, построенного специально для проведения матчей чемпионата мира. Арена вмещает 60 000 зрителей и оснащена по последнему слову техники.</p><p>Стадион соответствует всем международным стандартам и имеет раздвижную крышу. Первый матч на новой арене состоится уже через неделю.</p>",
                category: "sports",
                date: "2023-11-07",
                image: "https://images.unsplash.com/photo-1540747913346-19e32dc3e97e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Павел Сидоров",
                views: 1987
            },
            {
                id: 10,
                title: "Международный кинофестиваль объявил программу",
                excerpt: "Организаторы представили программу предстоящего международного кинофестиваля.",
                content: "<p>Сегодня были объявлены фильмы, которые будут представлены в основном конкурсе международного кинофестиваля. В программу вошли картины из 25 стран мира.</p><p>Особое внимание будет уделено дебютным работам молодых режиссеров. Фестиваль пройдет в следующем месяце и традиционно соберет звезд мирового кино.</p>",
                category: "culture",
                date: "2023-11-06",
                image: "https://images.unsplash.com/photo-1489599809516-9827b6d1cf13?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Анна Михайлова",
                views: 1678
            },
            {
                id: 11,
                title: "Саммит мировых лидеров по климату",
                excerpt: "В столице проходит саммит, посвященный вопросам изменения климата и экологическим инициативам.",
                content: "<p>Сегодня открылся саммит мировых лидеров, посвященный проблемам изменения климата. В мероприятии принимают участие главы государств и правительств из 50 стран.</p><p>Основной темой обсуждения стали меры по сокращению выбросов парниковых газов и переход на возобновляемые источники энергии. Ожидается подписание ряда международных соглашений.</p>",
                category: "politics",
                date: "2023-11-05",
                image: "https://images.unsplash.com/photo-1589652717521-10c0d092dea9?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Михаил Орлов",
                views: 2154
            },
            {
                id: 12,
                title: "Центробанк сохранил ключевую ставку",
                excerpt: "На заседании было принято решение оставить ключевую ставку на прежнем уровне.",
                content: "<p>Сегодня Центральный банк объявил о решении сохранить ключевую процентную ставку без изменений. Такое решение было принято на основании анализа текущей экономической ситуации.</p><p>Эксперты отмечают, что сохранение ставки будет способствовать стабильности на финансовых рынках и поддержит экономический рост. Следующее заседание по вопросу ставки состоится через месяц.</p>",
                category: "economy",
                date: "2023-11-04",
                image: "https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Татьяна Федорова",
                views: 1876
            },
            {
                id: 13,
                title: "Запуск нового спутника для исследования космоса",
                excerpt: "Ракета-носитель успешно вывела на орбиту научный спутник для изучения дальнего космоса.",
                content: "<p>Сегодня состоялся успешный запуск ракеты-носителя с новым научным спутником на борту. Аппарат предназначен для изучения галактик и поиска экзопланет.</p><p>Спутник оснащен уникальным телескопом, способным делать снимки в высоком разрешении. Миссия рассчитана на 5 лет и поможет ученым лучше понять структуру Вселенной.</p>",
                category: "technology",
                date: "2023-11-03",
                image: "https://images.unsplash.com/photo-1446776653964-20c1d3a81b06?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Владимир Алексеев",
                views: 3245
            },
            {
                id: 14,
                title: "Олимпийский комитет утвердил новые виды спорта",
                excerpt: "В программу следующих Олимпийских игр будут включены несколько новых видов спорта.",
                content: "<p>Международный олимпийский комитет утвердил список новых видов спорта, которые будут представлены на следующих летних Олимпийских играх. Среди новинок - спортивное скалолазание, серфинг и скейтбординг.</p><p>Решение было принято с целью привлечения более молодой аудитории и соответствия современным спортивным тенденциям. Спортсмены уже начали подготовку к отборочным соревнованиям.</p>",
                category: "sports",
                date: "2023-11-02",
                image: "https://images.unsplash.com/photo-1546519638-68e109498ffc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Никита Павлов",
                views: 1987
            },
            {
                id: 15,
                title: "Реставрация исторического памятника завершена",
                excerpt: "После трех лет работ завершена масштабная реставрация известного исторического памятника.",
                content: "<p>Сегодня состоялась церемония открытия после завершения масштабной реставрации одного из главных исторических памятников города. Работы продолжались три года и потребовали значительных инвестиций.</p><p>Реставраторы использовали традиционные материалы и техники, чтобы сохранить аутентичность памятника. Теперь он открыт для посещения и будет доступен для туристов ежедневно.</p>",
                category: "culture",
                date: "2023-11-01",
                image: "https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                author: "Светлана Ковалева",
                views: 1765
            }
        ];
    }
    
    // Получение всех новостей
    getAllNews() {
        return [...this.news]; // Возвращаем копию массива
    }
    
    // Поиск новостей по ключевым словам
    searchNews(keyword) {
        if (!keyword.trim()) return this.getAllNews();
        
        const lowerKeyword = keyword.toLowerCase();
        return this.getAllNews().filter(item => 
            item.title.toLowerCase().includes(lowerKeyword) || 
            item.excerpt.toLowerCase().includes(lowerKeyword)
        );
    }
    
    // Фильтрация по категории
    filterByCategory(category) {
        if (category === 'all') return this.getAllNews();
        return this.getAllNews().filter(item => item.category === category);
    }
    
    // Получение новости по ID
    getNewsById(id) {
        return this.getAllNews().find(item => item.id === id);
    }
    
    // Сортировка новостей
    sortNews(newsArray, sortBy) {
        const sorted = [...newsArray];
        if (sortBy === 'newest') {
            return sorted.sort((a, b) => new Date(b.date) - new Date(a.date));
        } else {
            return sorted.sort((a, b) => new Date(a.date) - new Date(b.date));
        }
    }
    
    // Получение новостей по странице (пагинация)
    getNewsByPage(newsArray, page, itemsPerPage = 6) {
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        return newsArray.slice(startIndex, endIndex);
    }
    
    // Получение категорий
    getCategories() {
        return [
            { id: 'all', name: 'Все новости' },
            { id: 'politics', name: 'Политика' },
            { id: 'economy', name: 'Экономика' },
            { id: 'technology', name: 'Технологии' },
            { id: 'sports', name: 'Спорт' },
            { id: 'culture', name: 'Культура' }
        ];
    }

    // === SMART IMAGE GENERATION ===

// стоп-слова (можешь расширять)
const STOP_WORDS = [
    'и', 'в', 'на', 'о', 'об', 'с', 'по', 'для', 'как',
    'что', 'это', 'к', 'из', 'за', 'при'
];

// извлечение ключевых слов из текста
function extractKeywords(text, max = 5) {
    if (!text) return [];

    return text
        .toLowerCase()
        .replace(/[^\p{L}\p{N}\s]/gu, '')
        .split(' ')
        .filter(word =>
            word.length > 3 &&
            !STOP_WORDS.includes(word)
        )
        .slice(0, max);
}

// генерация изображения через Unsplash
export function generateSmartImage({ title, category }) {
    const keywords = [
        ...extractKeywords(title, 4),
        category?.toLowerCase()
    ].filter(Boolean);

    const query = keywords.join(',');

    // фиксируем seed, чтобы картинка не менялась при перерисовке
    const seed = btoa(query).slice(0, 12);

    return `https://source.unsplash.com/800x500/?${query}&sig=${seed}`;
}

